var GM={};!function(e,n){var t=function(e){console.log(e)},i=function(e){return e.json()};n.Alert={error:function(n,t,i){var o=e.extension.getURL("images/error-128.png"),s={type:"basic",iconUrl:o,title:e.i18n.getMessage("appName"),message:n};return e.notifications.create(i,s),this},unblock:function(n,t,i){var o=e.extension.getURL("images/unblock.png"),s={type:"basic",iconUrl:o,title:e.i18n.getMessage("appName"),message:n};return e.notifications.create(i,s),this},block:function(n,t,i){var o=e.extension.getURL("images/block.png"),s={type:"basic",iconUrl:o,title:e.i18n.getMessage("appName"),message:n};return e.notifications.create(i,s),this}},n.admin={init:function(){var n=this;this.enabled=!1,this.menus=[],e.runtime.onMessage.addListener(function(e){n.onMessage(e)})},onMessage:function(e){"GM.admin"===e.cmd&&this.notify(e)},enable:function(){this.enabled||(this.enabled=!0,this.addAdminMenu())},disable:function(){this.enabled&&(this.enabled=!1,this.menus.forEach(function(n){e.contextMenus.remove(n)}))},handle:function(t,i){var o=t.menuItemId.substr(5),s=t.linkUrl;this.getUserId(s).then(function(t){if(!n.group_id)return void n.Alert.error("Ch∆∞a c√≥ nh√≥m n√†o ƒë∆∞·ª£c c·∫•u h√¨nh. B·∫°n h√£y s·ª≠a GM.group_id trong bg.js th√†nh id nh√≥m c·ªßa b·∫°n nh√©");if(!n.c_user)return void n.Alert.error("H√£y ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng!");if(!t||!t.id)return void n.Alert.error("Th√†nh vi√™n kh√¥ng t·ªìn t·∫°i!");if(t.id.toString()!==n.c_user.toString()){var s={cmd:o,u:t.id,cu:n.c_user,g:n.group_id,l:n.log_post_id};e.tabs.sendMessage(i.id,s)}else n.Alert.error("B·∫°n kh√¥ng th·ªÉ ch·∫∑n ch√≠nh m√¨nh!")}).catch(function(){n.Alert.error("Ch·ª©c nƒÉng ch·ªâ ho·∫°t ƒë·ªông v·ªõi li√™n k·∫øt ng∆∞·ªùi d√πng")})},getUserId:function(n){return new Promise(function(o,s){if(n){var r=new URL(n);if(r.pathname&&r.pathname.length>0){if(!("/profile.php"===r.pathname.toLowerCase()?r.searchParams.get("id"):r.pathname.substr(1)).includes("/"))return void e.storage.local.get("c_token",function(e){fetch("https://graph.facebook.com/?id="+r+"&access_token="+e.c_token+"&fields=id").then(i).then(function(e){console.log(e),o(e)}).catch(t)})}}s()})},addAdminMenu:function(){var n=this;this.menus.push(e.contextMenus.create({title:"‚ùå "+e.i18n.getMessage("removeUser"),id:"menu_remove",contexts:["link"],onclick:function(e,t){n.handle(e,t)},targetUrlPatterns:["https://*.facebook.com/*"]})),this.menus.push(e.contextMenus.create({title:"üíÄ "+e.i18n.getMessage("blockUser"),id:"menu_block",contexts:["link"],onclick:function(e,t){n.handle(e,t)},targetUrlPatterns:["https://*.facebook.com/*"]})),this.menus.push(e.contextMenus.create({title:"‚úÖ "+e.i18n.getMessage("unblockUser"),id:"menu_unblock",contexts:["link"],onclick:function(e,t){n.handle(e,t)},targetUrlPatterns:["https://*.facebook.com/*"]}))},notify:function(t){var i=e.i18n.getMessage(t.type+"Notify");("unblock"===t.type?n.Alert.unblock:n.Alert.block)(i+": "+t.user_id)}},n.admin.init()}(chrome,GM);